# 3rd Team Project
## 코로나 백신 접종 알리미

### Table of contents

- [서비스 시나리오](#서비스-시나리오)
  - [시나리오 테스트결과](#시나리오-테스트결과)
- [분석/설계](#분석설계)
- [구현](#구현)
  - [DDD 의 적용](#ddd-의-적용)
  - [Gateway 적용](#Gateway-적용)
  - [폴리글랏 퍼시스턴스](#폴리글랏-퍼시스턴스)
  - [동기식 호출 과 Fallback 처리](#동기식-호출-과-Fallback-처리)
  - [비동기식 호출 과 Eventual Consistency](#비동기식-호출-과-Eventual-Consistency)
- [운영](#운영)
  - [CI/CD 설정](#cicd설정)
  - [서킷 브레이킹 / 장애격리](#서킷-브레이킹-/-장애격리)
  - [오토스케일 아웃](#오토스케일-아웃)
  - [무정지 재배포](#무정지-재배포)
  

# 서비스 시나리오

## 기능적 요구사항

* 백신 관리
    1. 관리자는 전담 병원 정보(병원 이름, 일별 최대 접종 가능 인원)를 등록한다.
    2. 관리자는 백신 정보(백신 이름, 수량[병], 필요 접종 차수)를 등록한다.
    3. 관리자는 전담 병원에 백신을 공급한다.
 백신 관리자는 공급된 백신 수량의 접종 가능 수량을 등록한다.

* 예약 대기
    1. 접종자는 병원의 백신 접종 가능 수량이 부족한 경우 예약 대기를 선택한다.
    2. 접종자는 예약 대기 요청에 따라 예약 상태가 예약 대기로 변경 된다.
    3. 관리자는 전담 병원에 백신의 수량을 추가로 공급 할수 있다.
    4. 접종자의 상태가 예약 대기인 경우, 예약이 가능한 상황이 되었을때 알림을 받는다.
    5. 전담 병원의 백신이 추가 공급 되고, 백신 관리자가 접종 가능 수량이 등록하면, 예약 대기자에게 알람을 발송한다.

* 접종 예약
    1. 접종자는 접종 예약(병원, 날짜)을 요청한다. 접종자의 접종 예약에 의해, 해당 병원의 접종 가능 수량이 감소하고,  접종 예약일의 접종 가능 인원이 감소한다.
    2. 접종자의 예약 상태가 예약 등록으로 변경된다.
    3. 예약 관리자는 예약 상태가 예약 등록 상태인 예약을 접수한다.
    4. 접수한 예약은 예약 상태가 예약 완료로 변경된다.
    5. 예약 관리자가 접종자의 접수를 거절을 하는 경우, 예약 상태가 예약 불가로 변경된다
    6. 접종자는 예약일 하루전에 알림을 받을 수 있다.
    7. 접종자는 예약 현황을 확인 할 수 있다.

* 접종 처리
    1. 접종자가 접종을 완료하면, 병원의 접종 가능 수량이 감소한다.
    2. 접종자의 접종 상태가 접종 완료로 변경된다.
    3. 예약한 접종자가 접종을 완료하면, 예약 상태가 접종 완료로 변경된다.
    4. 다음 차수의 접종이 필요한 경우, 접종 상태를 접종 중으로 변경한다.

* 접종 예약 취소
    1. 접종자가 접종 예약을 취소하면,
    예약일의 병원의 접종 가능 인원과 접종 가능 수량이 증가한다.
    2. 접종자의 예약 취소가 완료 되고, 접종 가능 수량이 존재하면 예약 대기자에게 알람을 발송한다.
    3. 접종자의 접종 예약 취소에 따라 접종 상태가 예약 취소로 변경된다.

* 백신 폐기
    1. 백신 관리자는 공급받은 백신의 수량을 폐기한다.
    2. 백신 관리자는 백신 폐기 수량만큼 접종 가능 수량을 감소한다.
    3. 백신 폐기로 인한 미접종 예약 수량이, 예약수량 미만인 경우, 그 차이만큼의 늦은 날짜부터 예약을 자동으로 취소한다. 
    4. 예약 관리자는 접종자의 예약을 취소할 수 있다.
    5. 접종 관리자의 접종자 예약 취소시에는 취소 알림이 발생된다.
    6. 접종 관리자의 접종 예약 취소에 따라 예약 상태가 예약 취소로 변경된다.
    7. 예약 관리자의 예약 취소, 백신 관리자의 폐기로 인한 자동 예약 취소는
    8. 예약 대기자에게 알람을 발송하지 않는다.

* 현황 조회
    1. 관리자는 백신 접종수를 조회한다.
    2. 관리자는 병원별 백신 접종율을 조회한다.
    3. 관리자는 병원별 백신 폐기율을 조회한다.
    4. 접종 예약자는 예약 상태를 조회한다.
    5. 예약 관리자는 일별 예약 현황을 조회한다.
    6. 백신 관리자는 병원의 백신 보유 현황을 조회한다.

## 비기능적 요구사항
* 트랜잭션
    1. 접종자는 병원의 백신 접종 가능 수량만큼 일별 최대 접종 가능인원 내에서 접종 예약/처리가 가능하다. (Sync)
        |값|계산식|
        |---:|------|
        |미접종 수|총 접종 가능 수 - 접종 완료 수
        |총 접종 가능 수|총 접종 가능 잔량 - 예약 건수|
        |총 접종 가능 잔량|공급된 백신의 접종 가능 수량 - 접종 완료 수량|
        
    2. 접종자의 예약 예약 완료시 예약 가능 인원과 접종 가능 수량이 감소한다. (Sync)
    3. 접종자의 접종 예약 취소시 예약 가능 인원과 접종 가능 수량이 증가한다. (Asy
* 장애격리
    1. 예약 상태 업데이트에 장애가 발생하더라도 접종 처리는 할 수 있어야 한다. -> Async (event-driven), Eventual Consistency
    2. 예약 요청시, 예약이 불가가능한 경우, 예약 대기를 신청 할 수 있도록 유도한다. -> Circuit breaker, fallback
* 성능
    1. 접종예약자는 자신의 예약 현황을 확인 할 수 있다. (CQRS)
    2. 관리자는 접종 현황을 조회 할 수 있다 (CQRS)
    3. 백신 관리자는 백신 보유 현황을 조회할 수 있다.(CQRS)
    4. 예약 관리자는 일별 예약 현황을 조회할수 있다.(CQRS)
    5. 예약 상태가 바뀔때마다 카톡 등으로 알림을 보낼수 있어야 한다. (Event driven)
